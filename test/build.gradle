apply plugin: 'base'

def ENABLED_PROPERTY = 'withIntegrationTests'

def projEnabled = project.hasProperty(ENABLED_PROPERTY)
logger.lifecycle "Integration tests: ${projEnabled ? 'enabled' : 'disabled'}"
def supProj = project
def subTasks = [:]
subprojects {
    if (!projEnabled) {
        logger.info "$project disabled. No tasks will run."
    }
    tasks.configureEach {
        onlyIf {
            projEnabled
        }
    }
}

tasks.configureEach { t ->
    subprojects.each { sp ->
        if (sp.tasks.findByName(t.name)) {
            t.dependsOn sp.tasks.named(t.name)
        }
    }
}